# Домашнее задание по лекции "5.1. Введение в виртуализацию. Типы и функции гипервизоров. Обзор рынка вендоров и областей применения."

## Обязательная задача 1

Опишите кратко, как вы поняли: в чем основное отличие полной (аппаратной) виртуализации, паравиртуализации и виртуализации на основе ОС.

## Ответ

Если коротко, то основное отличие - где находится или чем является гипервизор. То есть, в аппаратной виртуализации сам гипервизор является операционной системой и управляет всем сам; в паравиртуализации гипервизор является устанавливаемым приложением операционной системы и для функционирования ему необходимо взаимодействовать с ней на уровне драйверов, а в третьем варианте - гипервизор глубоко ингегрирован и является компонентом операционной системы и может создавать виртуальные машины только с ядром своего типа (модифицированная копия самой себя).

---

## Обязательная задача 2

Выберите один из вариантов использования организации физических серверов, в зависимости от условий использования.

Организация серверов:

- физические сервера;

- паравиртуализация;

- виртуализация уровня ОС.

Условия использования:

- Высоконагруженная база данных, чувствительная к отказу;
  
- Различные web-приложения;
  
- Windows системы для использования бухгалтерским отделом;
  
- Системы, выполняющие высокопроизводительные расчеты на GPU.

Опишите, почему вы выбрали к каждому целевому использованию такую организацию.

## Ответ

- Для высоконагруженной базы данных, чувствительной к отказу главным приоритетом является отказоустойчивость. Её можно реализовать в том числе дублированием машины с реплицированием базы даных, а значит нужно несколько серверов (и желательно физически на разных машинах). Для этого хорошо подойдёт паравиртуализация, так как она позволяет разместить на отдельных физических серверах с разной аппаратной конфигурацией одинаковый образ виртуальной машины с настроенным ПО и окружением

- Для различных web-приложений нет конкретики в используемых средах (на чём написаны сервисы, на каких ОС фукнционируют) и не указаны особые требования к ресурсам, значит важна гибкость системы. В данном случае также хорошо подойдёт паравиртуализация, которая позволит использовать широкий набор используемых ОС и изолировать сервисы друг от друга, что в свою очередь повысит общую отказоустойчивость системы (например, если один из сервисов "поломает" свою машину, то это никак не отразится на функционировании остальных), а также настроить каждый сервис в соотвествии с его требованиями (ограничить ресурсы, настроить свой план резервирование и т.д.)
  
- В windows системах для использования бухгалтерским отделом вряд ли есть повышенные требования к производительности отдельных рабочих мест и вместе с тем, скорее всего, должен быть доступ к единой базе данных или каким-то общим документам. В данном случае хорошо подойдёт виртуализация уровня ОС, которая позволит сэкономить аппаратные ресурсы сервера (единый пул ресурсов на все ВМ) и создать большое количество изолированного окружения (по одной ВМ для каждого рабочего места сотрудника)

- Системы, выполняющие высокопроизводительные расчёты на GPU могут состоять из множества разных GPU разных производителей, что может породить несовместимость некоторых GPU с системой виртуализации и скорее всего добавит накладные расходы на виртуализацию оборудования, что существенно снизит эффективность вычислений. Поэтому в данно случае лучше использовать физические сервера без виртуализации

---

## Обязательная задача 3

Выберите подходящую систему управления виртуализацией для предложенного сценария. Детально опишите ваш выбор.

Сценарии:

1. 100 виртуальных машин на базе Linux и Windows, общие задачи, нет особых требований. Преимущественно Windows based инфраструктура, требуется реализация программных балансировщиков нагрузки, репликации данных и автоматизированного механизма создания резервных копий.
2. Требуется наиболее производительное бесплатное open source решение для виртуализации небольшой (20-30 серверов) инфраструктуры на базе Linux и Windows виртуальных машин.
3. Необходимо бесплатное, максимально совместимое и производительное решение для виртуализации Windows инфраструктуры.
4. Необходимо рабочее окружение для тестирования программного продукта на нескольких дистрибутивах Linux.

## Ответ

**Сценарий 1**. Управление множеством виртуальных машин с преимущественно Windows инфраструктурой логичнее делать в гипервизоре вендора преобладающей ОС, а именно **Hyper-V**. Так как продукт комменрческий, то, наверное, должен поддерживать большинство востребованных функций, например [резервное копирование](https://docs.microsoft.com/ru-ru/system-center/dpm/back-up-hyper-v-virtual-machines?view=sc-dpm-2019), [реплики](https://docs.microsoft.com/ru-ru/windows-server/virtualization/hyper-v/manage/set-up-hyper-v-replica) и балансировку нагрузки.

**Сценарий 2**. Для небольшого числа виртуальных машин со смешенной инфраструктурой подойдёт **VirtualBox**. Это кроссплатформенный бесплатный open source проект, обладающий интуитивно понятным графическим интерфейсом помимо коммандного интерфейса VBoxManage.

**Сценарий 3**. На лекции упоминали о принципах разработки **Xen Server**, как о медленно идущем, но не спотыкающемся человечке, то есть максимально стабильной и совместимой системе виртуализации (по сравнению с KVM). Для виртуализации Windows инфраструктуры наилучшим образом подойдёт **Xen VP** (работает в режиме паравиртуализации) из-за большей совместимости с Windows.

**Сценарий 4**. Если хостовый сервер построен на Linux, то логично использовать самое популярное решение, которое применяют другие, то есть **KVM**. На Windows можно использовать **VirtualBox**, который поддерживает шаблоны самых популярных дистрибутивов, а также магические "Other Linux".

---

## Обязательная задача 4

Опишите возможные проблемы и недостатки гетерогенной среды виртуализации (использования нескольких систем управления виртуализацией одновременно) и что необходимо сделать для минимизации этих рисков и проблем. Если бы у вас был выбор, то создавали бы вы гетерогенную среду или нет? Мотивируйте ваш ответ примерами.

## Ответ

Использование нескольких систем управления виртуализацией одновременно на одной физической системе чревато возникновением конфликта драйверов гипервизиров при доступе к аппаратным ресурсам вплоть до краха системы. Реальный пример из жизни: в хостовой системе Windows 10 использовался гипервизор VirtualBox. Для тестов потребовалось установить Docker. Как позже выяснилось, версия Docker под ОС Windows использует встроенный гипервизор Hyper-V. Во время установки происходит активация данного компонента с почти принудительной перезагрузкой системы. После перезагрузки и через несколько секунд после запуска VirtualBox происходит стабильный крах системы (экран смерти) - совместная работа невозможна. После такого опыта мне сложно представить вариант и причины почему невозможно не использовать гетерогенную среду виртуализации.

Если гетерогенная система виртуализации распределена на несколько физических систем (по одному гипервизору на каждый ПК), то это порождает сложности в обслуживании, так как системы скорее всего работают по разному, имеют разные системы команд и API, усложняется резервное копирование и т.п. Для поддержки потребуются специалист(ы) с бОльшим опытом работы, нежели при использовании одного гипервизора.

Для уменьшения рисков получения сбоев можно перенести все виртуальные машины в один гипервизор, либо разнести разные гипервизоры на разные физические компьютеры. Например, в приведённом примере Docker можно установить в отдельную виртуальную машину VirtualBox, а не на хостовую, либо на отдельный компьютер, подключенный к основному по сети.
