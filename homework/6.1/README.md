# Домашнее задание по лекуии "6.1. Типы и структура СУБД"

## Обязательная задача 1

Архитектор ПО решил проконсультироваться у вас, какой тип БД лучше выбрать для хранения определенных данных.
Выберите подходящие типы СУБД для каждого типа сущностей, которые нужно хранить в БД и объясните свой выбор.

- Электронные чеки в json виде

Основная сущность - чек в виде JSON файла - представлена документом (файлом), следовательно лучше всего подойдёт `документо-ориентированая` база данных (даже название типа говорит само за себя).

- Склады и автомобильные дороги для логистической компании

Основное назначение логистики - определение маршрутов, либо кратчайших, либо минимально-затратных, а для их построения и расчёта идеально подходят графы, где узлы - логистические центры, плечи/рёбра - дороги, веса/свойства - затраты на преодоление этой дороги. Логично использовать соотвествующие типы баз данных - `графовые`.

- Генеалогические деревья

Генеалогические деревья описывают родственные связи семей с чётко прослеживаемыми связями родитель-потомок, где каждый потомок может быть родителем следующих потомков, то есть явная **иерархическая модель**. Соответственно лучшим вариантом типа базы данных для хранения подобных сущностей будут `иерархические` или `сетевые`.

- Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации

Так как хранимые сущности представляют собой временные и не содержащие большого объёма информации данные, наилучшим выбором станут базы данных типа `ключ-значение` с функцией Time-To-Live, что позволит получить требуемый функционал "из коробки".

- Отношения клиент-покупка для интернет-магазина

Основная хранимая сущность - отношение или связь клиентов с их покупками. Значит нужно хранить данные и о покупках, и о клиентах и соответствующие связи клиентов с их покупками, для чего лучше подойдут `реляционные` базы данных (опять таки по определению `relation` - связь), так как они состоят из таблиц (сущностей: клиенты, товары, заказы), связанных между собой связями и исключают дублирование данных.

---

## Обязательная задача 2

Вы создали распределенное высоконагруженное приложение и хотите классифицировать его согласно CAP-теореме. Как бы вы классифицировали следующие системы по CAP и PACELC теоремам (каждый пункт - это отдельная реализация вашей системы и для каждого пункта надо привести классификацию):

Согласно **CAP** теореме - в любой распределённой системе можно обеспечить не более двух из трёх следующих свойств:

- `Consistency` (Согласованность) - в один момент времени данные во всех узлах не противоречат друг другу
  
- `Availability` (Доступность) - любой запрос к любому узлу завершается корректным откликом, но не гарантирует, что все ответы совпадают

- `Partition Tolerance` (Устойчивость к разделению) - расщепление системы на несколько изолированных секций не приводит к некорректности отклика от каждой из секций

Согласно теореме **PACELC** добавляется свойство `Latency` (задержка). Варианты: `PA` или `PC` + `EL` или `EC`

**Ответы**:

- Данные записываются на все узлы с задержкой до часа (асинхронная запись)

Если данные записываются на все узлы асинхронно и с допустимой задержкой до часа, то мы явно пожертвовали согласованностью (`-C`). Раз запись в узлы происходит асинхронно, то узлы во время записи куда-либо точно не блокируются на чтение, иначе мы бы получили не функциональный кластер, а значит у нас есть доступность (`+A`). Наиболее вероятно, что наша система устойчива к расщеплению (`+P`), так как узлы всегда доступны и у нас нет требования согласованности данных (следует из предыдущего). Итог: `AP`

Так как мы допускаем задержку синхронизации записи до часа, то вряд ли сделана ставка на согласовенность (исключается `EC`), следовательно по теореме **PACELC** мы имеем: `PA-EL` систему

- При сетевых сбоях, система может разделиться на 2 раздельных кластера

По описанию система может разделиться на 2 раздельных кластера, что явно говорит об обеспечении устойчивости к расщеплению (`+P`). Два **раздельных кластера** намекает на то, что оба они функционируют, а не то что честь системы выходит из работы, значит обеспечивается свойство доступности (`+A`). Одновременно, **два раздельных** кластера говорит о том, что данные в них возможно не согласованы (имеется потеря связи между ними) (`-C`). Итог: `AP`

Для классификации по теореме **PACELC** выражение "2 раздельных кластера" говорит о доступности системы, то есть `PA` и явно ставке не на согласовенность, так как при отсутствии связи ноды функционируют в отдельном кластере, а не блокируются (когда остаётся один **Master**), значит опять сделана ставка на задержку, то есть `EL`. Таким образом, получается система `PA-EL`

- Система может не прислать корректный ответ или сбросить соединение

Если система может не прислать ответ или сбросить соединение, то скорее всего она пытается обеспечить согласованность данных (`+C`), а занятый (выведенный из обращения) узел пытается синхронизировать данные, то есть обеспечить устойчивость к разделению (`+P`). Вместе с тем, отсутствие ответа говорит о недоступности узла, что противоречит одноимённому свойству (`-A`). Итог: `CP`

По классификации **PACELC** вывод не однозначный. Выражение "может не прислать корректный ответ", не означает, что система "не может прислать некорректный ответ" - то есть система может ответить, но некорректно и тогда это `PC-EL` система. А если считать, что некорректного ответа быть не может и узел системы просто игнорирует запрос, тогда система ближе к `PC-EC`

---

## Обязательная задача 3

Могут ли в одной системе сочетаться принципы BASE и ACID? Почему?

**Ответ**: Логично, что нет. На лекции упоминалось, что BASE противопоставляется ACID - что уже говорит об их взаимоисключении. Концепция ACID гарантирует точность и достоверность данных, разработана для высоконадёжных систем. Принципы BASE разработан для высокопроизводительных систем и гарантируют быстрый ответ, но не гарантирует что этот ответ будет достоверным. Возможный недостоверный ответ в концепции BASE исключает сочетание с гарантированной достоверностью ответа принципа ACID.

> Сергей Маньков про принцип BASE: "типо сел в спорт кар и едешь не в ту сторону зато быстро?"

---

## Обязательная задача 4

Вам дали задачу написать системное решение, основой которого бы послужили:

- фиксация некоторых значений с временем жизни
- реакция на истечение таймаута

Вы слышали о key-value хранилище, которое имеет механизм [Pub/Sub](https://habr.com/ru/post/278237/). 
Что это за система? Какие минусы выбора данной системы?

`Pub/Sub` - сокращённо от `Publish / Subscribe` что можно перевести как "Издатель / Подписчик" - это механизм построения обмена сообщениями при котором отправители сообщений (издатели), напрямую не связаны с получателями сообщений (подписчиками). Все сообщения классифицируются и не содержат сведений о своих подписчиках, которые в свою очередь получают свои сообщения на основе выбранных классов абстрагируясь от конкретных издателей.

Из статьи требованиям удовлетворяет БД [Redis](https://redis.io/docs/manual/) (тем более оно было на лекции)

Из очевидного, предполагаю, что основные минусы "вытекают" из особенности работы Redis - хранении данных исключительно в оперативной памяти. Отсюда следует, что при отказе БД потеряются все накопленные данные (или состояние откатится до последнего, сохранённого на диск если такая возможность есть). Объёмом доступной памяти ограничивается ёмкость хранилища БД. Также система не гарантирует доставку данных подписчикам и нет возможности узнать получены они или нет. 

---

[Дополнительные материалы](../6_am/)